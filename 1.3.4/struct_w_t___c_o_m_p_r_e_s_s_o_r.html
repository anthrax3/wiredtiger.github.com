<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: WT_COMPRESSOR Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="wiredtiger.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://wiredtiger.com/"><img alt="Logo" src="LogoFinal-header.png" alt="WiredTiger" /></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 1.3.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger/downloads#uploaded_downloads">Download</a>
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li><a href="license.html"><span>License</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('struct_w_t___c_o_m_p_r_e_s_s_o_r.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="struct_w_t___c_o_m_p_r_e_s_s_o_r-members.html">List of all members</a> &#124;
<a href="#pub-attribs">Public Attributes</a>  </div>
  <div class="headertitle">
<div class="title">WT_COMPRESSOR Struct Reference<div class="ingroups"><a class="el" href="group__wt__ext.html">WiredTiger Extension API</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The interface implemented by applications to provide custom compression.  
 <a href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a87c339a3442b719896fa5cbe2c530843"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843">compress</a> )(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp, int *compression_failed)</td></tr>
<tr class="memdesc:a87c339a3442b719896fa5cbe2c530843"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to compress a chunk of data.  <a href="#a87c339a3442b719896fa5cbe2c530843"></a><br/></td></tr>
<tr class="separator:a87c339a3442b719896fa5cbe2c530843"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf978486348484d467bd4f4032cf3795"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#acf978486348484d467bd4f4032cf3795">decompress</a> )(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td></tr>
<tr class="memdesc:acf978486348484d467bd4f4032cf3795"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to decompress a chunk of data.  <a href="#acf978486348484d467bd4f4032cf3795"></a><br/></td></tr>
<tr class="separator:acf978486348484d467bd4f4032cf3795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ae8cd41e9f3d65187a5e0209a075f02"><td class="memItemLeft" align="right" valign="top">int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02">pre_size</a> )(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, size_t *result_lenp)</td></tr>
<tr class="memdesc:a0ae8cd41e9f3d65187a5e0209a075f02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to size a destination buffer for compression.  <a href="#a0ae8cd41e9f3d65187a5e0209a075f02"></a><br/></td></tr>
<tr class="separator:a0ae8cd41e9f3d65187a5e0209a075f02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The interface implemented by applications to provide custom compression. </p>
<p>Compressors must implement the <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html" title="The interface implemented by applications to provide custom compression.">WT_COMPRESSOR</a> interface: the <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843" title="Callback to compress a chunk of data.">WT_COMPRESSOR::compress</a> and <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#acf978486348484d467bd4f4032cf3795" title="Callback to decompress a chunk of data.">WT_COMPRESSOR::decompress</a> callbacks must be specified, and <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02" title="Callback to size a destination buffer for compression.">WT_COMPRESSOR::pre_size</a> is optional. To build your own compressor, use one of the compressors in <code>ext/compressors</code> as a template: <code>ext/nop_compress</code> is a simple compressor that passes through data unchanged, and is a reasonable starting point.</p>
<p>Applications register their implementation with WiredTiger by calling <a class="el" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a4f26bfa799ae5e72b536ac93d6200783" title="Add a compression function.">WT_CONNECTION::add_compressor</a>.</p>
<div class="fragment"><div class="line">        <span class="keyword">static</span> <a class="code" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html" title="The interface implemented by applications to provide custom compression.">WT_COMPRESSOR</a> my_compressor = {</div>
<div class="line">            my_compress, my_decompress, my_pre_size };</div>
<div class="line">        ret = conn-&gt;<a class="code" href="struct_w_t___c_o_n_n_e_c_t_i_o_n.html#a4f26bfa799ae5e72b536ac93d6200783" title="Add a compression function.">add_compressor</a>(conn, <span class="stringliteral">&quot;my_compress&quot;</span>, &amp;my_compressor, NULL);</div>
</div><!-- fragment --></div><h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a87c339a3442b719896fa5cbe2c530843"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_COMPRESSOR::compress)(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp, int *compression_failed)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to compress a chunk of data. </p>
<p><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843" title="Callback to compress a chunk of data.">WT_COMPRESSOR::compress</a> is given a source buffer and a destination buffer, by default of the same size. If the callback can compress the buffer to a smaller size in the destination, it does so, sets the <code>compression_failed</code> return to 0 and returns 0. If compression does not produce a smaller result, the callback sets the <code>compression_failed</code> return to 1 and returns 0. If another error occurs, it returns an errno or WiredTiger error code.</p>
<p>On entry, <code>src</code> will point to memory, with the length of the memory in <code>src_len</code>. After successful completion, the callback should return <code>0</code> and set <code>result_lenp</code> to the number of bytes required for the compressed representation.</p>
<p>If compression would not shrink the data or the <code>dst</code> buffer is not large enough to hold the compressed data, the callback should set <code>compression_failed</code> to a non-zero value and return 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>the data to compress </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src_len</td><td>the length of the data to compress </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>the destination buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_len</td><td>the length of the destination buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result_lenp</td><td>the length of the compressed data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">compression_failed</td><td>non-zero if compression did not decrease the length of the data (compression may not have completed) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * A simple compression example that passes data through unchanged.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">my_compress(<a class="code" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html" title="The interface implemented by applications to provide custom compression.">WT_COMPRESSOR</a> *compressor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a> *session,</div>
<div class="line">    uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div>
<div class="line">    uint8_t *dst, <span class="keywordtype">size_t</span> dst_len,</div>
<div class="line">    <span class="keywordtype">size_t</span> *result_lenp, <span class="keywordtype">int</span> *compression_failed)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Unused parameters */</span></div>
<div class="line">        (void)compressor;</div>
<div class="line">        (void)session;</div>
<div class="line"></div>
<div class="line">        *compression_failed = 0;</div>
<div class="line">        <span class="keywordflow">if</span> (dst_len &lt; src_len) {</div>
<div class="line">                *compression_failed = 1;</div>
<div class="line">                <span class="keywordflow">return</span> (0);</div>
<div class="line">        }</div>
<div class="line">        memcpy(dst, src, src_len);</div>
<div class="line">        *result_lenp = src_len;</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf978486348484d467bd4f4032cf3795"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_COMPRESSOR::decompress)(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, uint8_t *dst, size_t dst_len, size_t *result_lenp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to decompress a chunk of data. </p>
<p><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#acf978486348484d467bd4f4032cf3795" title="Callback to decompress a chunk of data.">WT_COMPRESSOR::decompress</a> is given a source buffer and a destination buffer. The contents are switched from <code>compress:</code> the source buffer is the compressed value, and the destination buffer is sized to be the original size. If the callback successfully decompresses the source buffer to the destination buffer, it returns 0. If an error occurs, it returns an errno or WiredTiger error code. The source buffer that <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#acf978486348484d467bd4f4032cf3795" title="Callback to decompress a chunk of data.">WT_COMPRESSOR::decompress</a> is given may have a size that is rounded up from the size originally produced by <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843" title="Callback to compress a chunk of data.">WT_COMPRESSOR::compress</a>, with the remainder of the buffer set to zeroes. Most compressors do not care about this difference if the size to be decompressed can be implicitly discovered from the compressed data. If your compressor cares, you may need to allocate space for, and store, the actual size in the compressed buffer. See the source code for the included snappy compressor for an example.</p>
<p>On entry, <code>src</code> will point to memory, with the length of the memory in <code>src_len</code>. After successful completion, the callback should return <code>0</code> and set <code>result_lenp</code> to the number of bytes required for the decompressed representation.</p>
<p>If the <code>dst</code> buffer is not big enough to hold the decompressed data, the callback should return an error.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>the data to decompress </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src_len</td><td>the length of the data to decompress </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>the destination buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_len</td><td>the length of the destination buffer </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result_lenp</td><td>the length of the decompressed data </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * A simple decompression example that passes data through unchanged.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">my_decompress(<a class="code" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html" title="The interface implemented by applications to provide custom compression.">WT_COMPRESSOR</a> *compressor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a> *session,</div>
<div class="line">    uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div>
<div class="line">    uint8_t *dst, <span class="keywordtype">size_t</span> dst_len,</div>
<div class="line">    <span class="keywordtype">size_t</span> *result_lenp)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Unused parameters */</span></div>
<div class="line">        (void)compressor;</div>
<div class="line">        (void)session;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (dst_len &lt; src_len)</div>
<div class="line">                <span class="keywordflow">return</span> (ENOMEM);</div>
<div class="line"></div>
<div class="line">        memcpy(dst, src, src_len);</div>
<div class="line">        *result_lenp = src_len;</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0ae8cd41e9f3d65187a5e0209a075f02"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int(* WT_COMPRESSOR::pre_size)(<a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a> *compressor, <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html">WT_SESSION</a> *session, uint8_t *src, size_t src_len, size_t *result_lenp)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback to size a destination buffer for compression. </p>
<p><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02" title="Callback to size a destination buffer for compression.">WT_COMPRESSOR::pre_size</a> is an optional callback that, given the source buffer and size, produces the size of the destination buffer to be given to <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843" title="Callback to compress a chunk of data.">WT_COMPRESSOR::compress</a>. This is useful for compressors that assume that the output buffer is sized for the worst case and thus no overrun checks are made. If your compressor works like this, <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02" title="Callback to size a destination buffer for compression.">WT_COMPRESSOR::pre_size</a> will need to be defined. See the source code for the snappy compressor for an example. However, if your compressor detects and avoids overruns against its target buffer, you will not need to define <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02" title="Callback to size a destination buffer for compression.">WT_COMPRESSOR::pre_size</a>. When <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a0ae8cd41e9f3d65187a5e0209a075f02" title="Callback to size a destination buffer for compression.">WT_COMPRESSOR::pre_size</a> is set to NULL, the destination buffer is sized the same as the source buffer. This is always sufficient, since a compression result that is larger than the source buffer is discarded by WiredTiger.</p>
<p>If not NULL, this callback is called before each call to WT_COMPRESS::compress to determine the size of the destination buffer to provide. If the callback is NULL, the destination buffer will be the same size as the source buffer.</p>
<p>The callback should set <code>result_lenp</code> to a suitable buffer size for compression, typically the maximum length required by <a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html#a87c339a3442b719896fa5cbe2c530843" title="Callback to compress a chunk of data.">WT_COMPRESSOR::compress</a>.</p>
<p>This callback function is for compressors that require an output buffer larger than the source buffer (for example, that do not check for buffer overflow during compression).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>the data to compress </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src_len</td><td>the length of the data to compress </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">result_lenp</td><td>the required destination buffer size </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero for success, non-zero to indicate an error.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * A simple pre-size example that returns the source length.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">my_pre_size(<a class="code" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html" title="The interface implemented by applications to provide custom compression.">WT_COMPRESSOR</a> *compressor, <a class="code" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a> *session,</div>
<div class="line">    uint8_t *src, <span class="keywordtype">size_t</span> src_len,</div>
<div class="line">    <span class="keywordtype">size_t</span> *result_lenp)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Unused parameters */</span></div>
<div class="line">        (void)compressor;</div>
<div class="line">        (void)session;</div>
<div class="line">        (void)src;</div>
<div class="line"></div>
<div class="line">        *result_lenp = src_len;</div>
<div class="line">        <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_w_t___c_o_m_p_r_e_s_s_o_r.html">WT_COMPRESSOR</a></li>
    <li class="footer">Copyright (c) 2008-2012 WiredTiger, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
  </ul>
</div>
</body>
</html>
