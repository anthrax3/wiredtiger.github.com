<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiredTiger: Transactions</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="wiredtiger.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->

<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo">
    <div class="logo"><a href="http://wiredtiger.com/"><img src="LogoFinal-header.png" alt="WiredTiger" /></a></div>
  </td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">
   &#160;<span id="projectnumber">Version 1.2.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>
<div class="banner">
  <a href="https://github.com/wiredtiger/wiredtiger">Fork me on GitHub</a>
  <a class="last" href="http://groups.google.com/group/wiredtiger-users">Join my user group</a>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li><a href="license.html"><span>License</span></a></li>
      <li><a href="https://github.com/wiredtiger/wiredtiger/downloads/"><span>Download</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('transactions.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Transactions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="transactions_acid"></a>
ACID properties</h2>
<p>Transactions provide a powerful abstraction for multiple threads to operate on data concurrently because they have the following properties:</p>
<ul>
<li>Atomicity: all or none of a transaction is completed.</li>
<li>Consistency: if each transaction maintains some property when considered separately, then the combined effect of executing the transactions concurrently will maintain the same property.</li>
<li>Isolation: developers can reason about transactions as if they run single-threaded.</li>
<li>Durability: once a transaction commits, its updates cannot be lost.</li>
</ul>
<p>In WiredTiger release 1.2, support for transactions was added with the following caveats to the ACID properties:</p>
<ul>
<li>the maximum level of isolation supported is snapshot isolation. See <a class="el" href="transactions.html#transaction_isolation">Isolation levels</a> for more details.</li>
<li>only coarse-grained durability is supported: updates become durable when they are part of a checkpoint, not at commit time. If there is a crash, commits since the last checkpoint will be lost.</li>
</ul>
<h2><a class="anchor" id="transactions_api"></a>
Transactional API</h2>
<p>In WiredTiger, the transactional context is managed by the <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a> class. Applications call <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a7e26b16b26b5870498752322fad790bf" title="Start a transaction in this session.">WT_SESSION::begin_transaction</a> to start a new transaction, which is only permitted when no cursors are open. Operations performed with that <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html" title="All data operations are performed in the context of a WT_SESSION.">WT_SESSION</a> handle are then part of the transaction, and their effects can be committed by calling <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a712226eca5ade5bd123026c624468fa2" title="Commit the current transaction.">WT_SESSION::commit_transaction</a> or <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#ab45f521464ad9e54d9b15efc2ffe20a1" title="Roll back the current transaction.">WT_SESSION::rollback_transaction</a>, both of which implicitly close any open cursors.</p>
<p>When transactions are used, concurrent update operations will fail with the <a class="el" href="group__wt.html#ga9650b6e97a88921ec1302935908d0c47" title="Conflict between concurrent operations.">WT_DEADLOCK</a> error if they conflict with a concurrent transaction. Transactions should be rolled back with <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#ab45f521464ad9e54d9b15efc2ffe20a1" title="Roll back the current transaction.">WT_SESSION::rollback_transaction</a> and retried if this error occurs.</p>
<h2><a class="anchor" id="transactions_cc"></a>
Concurrency control</h2>
<p>WiredTiger uses optimistic concurrency control algorithms. This avoids the bottleneck of a centralized lock manager, and means that transactional operations do not block: reads do not block writes, and vice versa.</p>
<p>Further, writes do not block writes, but as mentioned above, concurrent transactions updating the same value will fail with <a class="el" href="group__wt.html#ga9650b6e97a88921ec1302935908d0c47" title="Conflict between concurrent operations.">WT_DEADLOCK</a>. Some applications may benefit from application-level synchronization to avoid repeated attempts to rollback and update the same value.</p>
<h2><a class="anchor" id="transaction_isolation"></a>
Isolation levels</h2>
<p>The default isolation level is <code>snapshot</code>, which means that each transaction reads the versions of records that were committed before the transaction started.</p>
<p>Snapshot isolation is a strong guarantee, but not equivalent to a single-threaded execution of the transactions, known as serializable isolation. Concurrent transactions T1 and T2 running under snapshot isolation may both commit and produce a state that neither (T1 followed by T2) or (T2 followed by T1) could have produced, if there is overlap between T1's reads and T2's writes, and between T1's writes and T2's reads.</p>
<p>Weaker isolation levels are also provided, including <code>read-uncommitted</code>, which always reads the most recent version of data, regardless of whether it is committed.</p>
<h2><a class="anchor" id="transaction_recovery"></a>
Checkpoints and Recovery</h2>
<p>Recovery is run automatically when a data source is opened. Any changes since the last checkpoint are discarded, and the application restarts from a consistent point in the transaction history.</p>
<p>This suggests the importance of regular checkpoints: they limit the volume of commits that may be lost in a crash. See <a class="el" href="struct_w_t___s_e_s_s_i_o_n.html#a6550c9079198955c5071583941c85bbf" title="Write a transactionally consistent snapshot of a database or set of objects.">WT_SESSION::checkpoint</a> and <a class="el" href="checkpoints.html">Checkpoints</a> for further information about checkpoints.</p>
<h2><a class="anchor" id="transaction_example"></a>
Code samples</h2>
<p>The code below is taken from the complete example program <a class="el" href="ex_transaction_8c-example.html">ex_transaction.c</a>.</p>
<div class="fragment"><pre class="fragment">        session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#a7e26b16b26b5870498752322fad790bf" title="Start a transaction in this session.">begin_transaction</a>(session, NULL);
        <span class="comment">/* ... */</span>
        session-&gt;<a class="code" href="struct_w_t___s_e_s_s_i_o_n.html#a712226eca5ade5bd123026c624468fa2" title="Commit the current transaction.">commit_transaction</a>(session, NULL);
</pre></div></div></div><!-- contents -->
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">Reference Guide</a>      </li>
      <li class="navelem"><a class="el" href="programming.html">Writing WiredTiger applications</a>      </li>

    <li class="footer">Copyright (c) 2008-2012 WiredTiger, Inc.  All rights reserved.  Contact <a href="mailto:info@wiredtiger.com">info@wiredtiger.com</a> for more information.</li>
   </ul>
 </div>


</body>
</html>
